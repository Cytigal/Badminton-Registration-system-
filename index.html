<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>羽球社 報名系統</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
        }
        .form-input:focus, .form-select:focus, .form-textarea:focus, .form-checkbox:focus, .form-radio:focus {
            outline: 2px solid transparent;
            outline-offset: 2px;
            --tw-ring-color: #0d9488; /* teal-600 */
            box-shadow: 0 0 0 2px var(--tw-ring-color);
        }
        .error-message { display: none; color: #ef4444; font-size: 0.875rem; margin-top: 0.25rem; }
        .is-invalid { border-color: #ef4444; }
        .is-invalid:focus { --tw-ring-color: #ef4444; }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #14b8a6; /* teal-500 */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: none;
            margin-left: 1rem;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50">

    <div class="container mx-auto max-w-3xl px-4 py-12 sm:py-16">
        
        <header class="text-center mb-10">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-800">生涯規劃俱樂部 羽球社</h1>
            <p class="mt-3 text-md text-gray-600">歡迎加入我們的羽球大家庭！無論您是新手或高手，都歡迎一起來享受揮拍的樂趣！</p>
        </header>

        <form id="registrationForm" class="bg-white p-8 sm:p-10 rounded-xl shadow-lg space-y-8" novalidate>
            <!-- 活動資訊 -->
            <fieldset class="border-b border-gray-200 pb-8">
                <legend class="text-xl font-semibold text-gray-900 mb-4">社團資訊</legend>
                <div class="space-y-3 text-gray-700">
                    <p><strong>活動主題：</strong> 羽球社零打團</p>
                    <p><strong>活動日期：</strong> 8/2 (星期六)</p>
                    <p><strong>活動時間：</strong> 晚上 6:00 - 8:00</p>
                    <p><strong>活動地點：</strong> 臺北市大同運動中心 (臺北市大同區大龍街51號)</p>
                    <p><strong>費用：</strong> <span class="text-teal-600 font-bold">新台幣 $200 元/人</span> (含場地費與基本球費)</p>
                    <p><strong>使用球種：</strong> RSL No.4</p>
                </div>
            </fieldset>

            <!-- 報名者資訊 -->
            <fieldset class="border-b border-gray-200 pb-8">
                <legend class="text-xl font-semibold text-gray-900 mb-6">報名者資訊</legend>
                <div class="grid grid-cols-1 gap-y-6 gap-x-6 sm:grid-cols-2">
                    <div>
                        <label for="fullName" class="block text-sm font-medium text-gray-700">姓名 <span class="text-red-500">*</span></label>
                        <input type="text" name="fullName" id="fullName" required class="form-input mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500">
                        <p id="fullNameError" class="error-message">請輸入您的姓名</p>
                    </div>
                    <div>
                        <label for="phone" class="block text-sm font-medium text-gray-700">聯絡電話 <span class="text-red-500">*</span></label>
                        <input type="tel" name="phone" id="phone" required class="form-input mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500">
                         <p id="phoneError" class="error-message">請輸入您的聯絡電話</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">性別 <span class="text-red-500">*</span></label>
                        <div class="mt-2 flex items-center space-x-6">
                            <div class="flex items-center">
                                <input id="genderMale" name="gender" type="radio" value="男" required class="form-radio h-4 w-4 text-teal-600 border-gray-300 focus:ring-teal-500">
                                <label for="genderMale" class="ml-2 block text-sm text-gray-900">男</label>
                            </div>
                            <div class="flex items-center">
                                <input id="genderFemale" name="gender" type="radio" value="女" class="form-radio h-4 w-4 text-teal-600 border-gray-300 focus:ring-teal-500">
                                <label for="genderFemale" class="ml-2 block text-sm text-gray-900">女</label>
                            </div>
                        </div>
                        <p id="genderError" class="error-message">請選擇您的性別</p>
                    </div>
                    <div>
                        <label for="source" class="block text-sm font-medium text-gray-700">介紹人 <span class="text-red-500">*</span></label>
                        <input type="text" name="source" id="source" required class="form-input mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500">
                        <p id="sourceError" class="error-message">請輸入介紹人姓名</p>
                    </div>
                    <div class="sm:col-span-2">
                        <label for="email" class="block text-sm font-medium text-gray-700">電子郵件 <span class="text-red-500">*</span></label>
                        <input type="email" name="email" id="email" required class="form-input mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500" placeholder="我們將透過此信箱發送通知">
                        <p id="emailError" class="error-message">請輸入有效的電子郵件地址</p>
                    </div>
                    <div class="sm:col-span-2">
                        <label for="badmintonLevel" class="block text-sm font-medium text-gray-700">羽球程度 <span class="text-red-500">*</span></label>
                        <select id="badmintonLevel" name="badmintonLevel" required class="form-select mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500">
                            <option value="">請選擇您的程度</option>
                            <option value="新手">新手 (剛接觸，正在學習規則與握拍)</option>
                            <option value="初階">初階 (可與球友簡單對打，但穩定性不高)</option>
                            <option value="初中">初中 (可連續對打，了解基本跑位，會使用高遠球)</option>
                            <option value="中階">中階 (穩定對打，會運用切、殺、吊等技巧)</option>
                            <option value="中高">中高 (球路穩定且具戰術意識，常參與零打或比賽)</option>
                            <option value="高階">高階 (校隊或乙組以上實力，精通各項技術)</option>
                            <option value="職業">職業 (甲組或職業選手等級)</option>
                        </select>
                        <p id="badmintonLevelError" class="error-message">請選擇您的羽球程度</p>
                    </div>
                </div>
            </fieldset>
            
            <!-- 其他資訊 -->
            <fieldset class="border-b border-gray-200 pb-8">
                <legend class="text-xl font-semibold text-gray-900 mb-4">其他資訊</legend>
                <div class="space-y-6">
                    <div>
                         <label class="block text-sm font-medium text-gray-700">您希望主要參與的組別？<span class="text-red-500">*</span></label>
                         <div class="mt-2 space-y-2">
                             <div class="flex items-center">
                                 <input id="group1" name="preferredGroup" type="radio" value="輕鬆對打組" required class="form-radio h-4 w-4 text-teal-600 border-gray-300 focus:ring-teal-500">
                                 <label for="group1" class="ml-3 text-sm text-gray-600">輕鬆對打組 (享受運動，開心流汗)</label>
                             </div>
                             <div class="flex items-center">
                                 <input id="group2" name="preferredGroup" type="radio" value="技巧訓練組" class="form-radio h-4 w-4 text-teal-600 border-gray-300 focus:ring-teal-500">
                                 <label for="group2" class="ml-3 text-sm text-gray-600">技巧訓練組 (想精進球技與戰術)</label>
                             </div>
                             <div class="flex items-center">
                                 <input id="group3" name="preferredGroup" type="radio" value="競賽挑戰組" class="form-radio h-4 w-4 text-teal-600 border-gray-300 focus:ring-teal-500">
                                 <label for="group3" class="ml-3 text-sm text-gray-600">競賽挑戰組 (目標是參加比賽)</label>
                             </div>
                         </div>
                         <p id="preferredGroupError" class="error-message">請選擇您想參與的組別</p>
                    </div>
                </div>
            </fieldset>

            <!-- 繳費資訊 -->
            <fieldset class="border-b border-gray-200 pb-8">
                <legend class="text-xl font-semibold text-gray-900 mb-4">繳費資訊</legend>
                <div>
                     <label class="block text-sm font-medium text-gray-700">繳費方式 <span class="text-red-500">*</span></label>
                     <div class="mt-2 flex items-center space-x-6">
                         <div class="flex items-center">
                             <input id="payOnsite" name="paymentMethod" type="radio" value="由介紹人代收" required class="form-radio h-4 w-4 text-teal-600 border-gray-300 focus:ring-teal-500">
                             <label for="payOnsite" class="ml-2 block text-sm text-gray-900">由介紹人代收</label>
                         </div>
                     </div>
                     <p id="paymentMethodError" class="error-message">請選擇繳費方式</p>
                </div>
            </fieldset>

            <!-- 報名須知 -->
            <fieldset>
                <legend class="text-xl font-semibold text-gray-900 mb-4">報名須知</legend>
                <div class="prose prose-sm text-gray-600 max-w-none">
                    <ul class="list-disc space-y-2 pl-5">
                        <li>如需取消報名，請於活動前 6 個小時通知，以利重新找人。</li>
                        <li>請自備球具、球拍、球鞋，活動前後需暖身與收操。</li>
                        <li>請保持尊重、禮貌、友善。</li>
                    </ul>
                </div>
            </fieldset>

            <!-- 提交 -->
            <div class="pt-5">
                <button type="submit" id="submitButton" class="w-full flex justify-center items-center py-3 px-4 border border-transparent rounded-md shadow-sm text-lg font-medium text-white bg-teal-600 hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition-colors duration-200 disabled:bg-teal-300">
                    <span id="buttonText">確認送出報名</span>
                    <div id="buttonLoader" class="loader"></div>
                </button>
            </div>
        </form>
    </div>

    <!-- 成功/失敗提示 Modal -->
    <div id="responseModal" class="fixed z-10 inset-0 overflow-y-auto hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div id="modalIconContainer" class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-green-100 sm:mx-0 sm:h-10 sm:w-10"></div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                            <h3 class="text-lg leading-6 font-medium text-gray-900" id="modalTitle"></h3>
                            <div class="mt-2">
                                <p class="text-sm text-gray-500" id="modalMessage"></p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" id="closeModal" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-teal-600 text-base font-medium text-white hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 sm:ml-3 sm:w-auto sm:text-sm">
                        關閉
                    </button>
                </div>
            </div>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // --- 變數定義 ---
    const form = document.getElementById('registrationForm');
    const submitButton = document.getElementById('submitButton');
    const buttonText = document.getElementById('buttonText');
    const buttonLoader = document.getElementById('buttonLoader');
    
    // Google Apps Script 部署後的網址
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbywhu0PpDjDNKfve5ju2B3X1fdD68vWHcRNxvax4yFQM5bYIoGZ2N0U5CmiPygDkQhP/exec';

    // --- Modal 相關 ---
    const responseModal = document.getElementById('responseModal');
    const closeModalButton = document.getElementById('closeModal');
    const modalIconContainer = document.getElementById('modalIconContainer');
    const modalTitle = document.getElementById('modalTitle');
    const modalMessage = document.getElementById('modalMessage');
    const successIcon = `<svg class="h-6 w-6 text-green-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>`;
    const errorIcon = `<svg class="h-6 w-6 text-red-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>`;

    function showModal(isSuccess, message) {
        if (isSuccess) {
            modalIconContainer.innerHTML = successIcon;
            modalIconContainer.className = 'mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-green-100 sm:mx-0 sm:h-10 sm:w-10';
            modalTitle.textContent = '報名成功！';
            modalMessage.textContent = '我們已收到您的報名資料，期待在球場上與您相見！';
        } else {
            modalIconContainer.innerHTML = errorIcon;
            modalIconContainer.className = 'mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10';
            modalTitle.textContent = '報名失敗';
            modalMessage.textContent = message || '發生未知的錯誤，請稍後再試或直接與我們聯繫。';
        }
        responseModal.classList.remove('hidden');
    }

    // --- 表單驗證邏輯 ---
    const fieldsToValidate = { 
        'fullName': 'fullNameError', 
        'phone': 'phoneError', 
        'source': 'sourceError',
        'email': 'emailError', 
        'badmintonLevel': 'badmintonLevelError'
    };
    function showError(fieldId, errorId) { const field = document.getElementById(fieldId); const error = document.getElementById(errorId); if (field && error) { field.classList.add('is-invalid'); error.style.display = 'block'; } }
    function hideError(fieldId, errorId) { const field = document.getElementById(fieldId); const error = document.getElementById(errorId); if (field && error) { field.classList.remove('is-invalid'); error.style.display = 'none'; } }
    function validateEmail(email) { const re = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/; return re.test(String(email).toLowerCase()); }
    
    function validateForm() {
        let isValid = true;
        
        Object.entries(fieldsToValidate).forEach(([fieldId, errorId]) => hideError(fieldId, errorId));
        ['genderError', 'preferredGroupError', 'paymentMethodError'].forEach(id => {
            const errorEl = document.getElementById(id);
            if (errorEl) errorEl.style.display = 'none';
        });

        Object.entries(fieldsToValidate).forEach(([fieldId, errorId]) => {
            const field = document.getElementById(fieldId);
            if (!field.value.trim()) {
                showError(fieldId, errorId);
                isValid = false;
            } else if (fieldId === 'email' && !validateEmail(field.value.trim())) {
                showError(fieldId, errorId);
                isValid = false;
            }
        });

        if (!document.querySelector('input[name="gender"]:checked')) {
            document.getElementById('genderError').style.display = 'block';
            isValid = false;
        }
        if (!document.querySelector('input[name="preferredGroup"]:checked')) {
            document.getElementById('preferredGroupError').style.display = 'block';
            isValid = false;
        }
        if (!document.querySelector('input[name="paymentMethod"]:checked')) {
            document.getElementById('paymentMethodError').style.display = 'block';
            isValid = false;
        }

        return isValid;
    }

    // --- 事件監聽 ---
    closeModalButton.addEventListener('click', () => { responseModal.classList.add('hidden'); });
    responseModal.addEventListener('click', (event) => { if (event.target === responseModal) responseModal.classList.add('hidden'); });
    
    // --- 表單提交 ---
    form.addEventListener('submit', function(event) {
        event.preventDefault();
        if (!validateForm()) {
            console.log('表單驗證失敗');
            return;
        }

        if (SCRIPT_URL === 'YOUR_WEB_APP_URL') {
            showModal(false, '系統設定錯誤：尚未設定後端資料接收網址。');
            return;
        }

        submitButton.disabled = true;
        buttonText.style.display = 'none';
        buttonLoader.style.display = 'block';

        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());

        fetch(SCRIPT_URL, {
            method: 'POST',
            mode: 'cors',
            cache: 'no-cache',
            headers: { 'Content-Type': 'text/plain;charset=utf-8' },
            body: JSON.stringify(data)
        })
        .then(res => res.json())
        .then(response => {
            if (response.result === 'success') {
                showModal(true);
                form.reset();
            } else {
                throw new Error(response.error || '未知的後端錯誤');
            }
        })
        .catch(error => {
            console.error('Error!', error);
            showModal(false, `提交失敗，請檢查您的網路連線或稍後再試。錯誤詳情: ${error.message}`);
        })
        .finally(() => {
            submitButton.disabled = false;
            buttonText.style.display = 'inline';
            buttonLoader.style.display = 'none';
        });
    });
});
</script>

</body>
</html>
